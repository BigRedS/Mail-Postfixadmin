#! /usr/bin/perl

use strict;
use Mail::Vpostmail;
use Getopt::Std;
my %opt;
getopts('lh', \%opt);

my $domain = pop;#
if(exists($opt{h})){
	print usage();
	exit 0;
}

my $v = Mail::Vpostmail->new();

if ($domain eq ''){
	foreach($v->listDomains){
		$v->setDomain($_);
		if ($v->domainIsAlias){
			my $target = ($v->getAliasDomainTarget);
			print "$_\t(alias for $target)\n";
		}else{
			print "$_\n";
		}
	}
	exit 0;
}

my %info;
$v->setDomain($domain);
if ($v->domainExists){
	if ($v->domainIsAlias){
		$v->setDomain($v->getAliasDomainTarget);
	}
	if(exists($opt{l})){
		foreach($v->listUsers){
			print $_."\n";
		}
	}else{
		%info = $v->getDomainInfo();
		foreach(sort(keys(%info))){
			unless($_ =~ /^mailboxes$/){
				printf('%-14s%s', $_, $info{$_});
				print "\n";
			}
		}
	}
}else{
	print STDERR "Domain $domain not found\n";
	exit 1;
}


sub usage{
return <<EOF;
vdominfo

Usage: 
  vdominfo [options[ <domain>

Prints out info on a domain. No analogy with vpopmail's
vdominfo is attempted.

Options:
  -l   print a list of mailboxes rather than domain properties

EOF
}
